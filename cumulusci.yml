minimum_cumulusci_version: "2.5.9"
project:
    name: pmdm
    package:
        name: Program Management Data Model
        namespace: pmdm0
        api_version: "46.0"
    source_format: sfdx

orgs:
    scratch:
        dev_namespaced:
            config_file: orgs/dev.json
            days: 7
            namespaced: True
        prerelease:
            config_file: orgs/prerelease.json
            days: 7
        npsp:
            config_file: orgs/npsp.json
            days: 7
        npsp_namespaced:
            config_file: orgs/npsp.json
            days: 7
            namespaced: True
        caseman:
            config_file: orgs/dev.json
            days: 7
        caseman_namespaced:
            config_file: orgs/dev.json
            days: 7
            namespaced: True
        caseman_npsp:
            config_file: orgs/npsp.json
            days: 7
        caseman_npsp_namespaced:
            config_file: orgs/npsp.json
            days: 7
            namespaced: True

tasks:
    cache_namespaces_in_org_config:
        description: Caches namespaces information in org_config
        class_path: tasks.namespaces.CacheNamespaces
        group: Namespaces

    namespace_execute_anonymous:
        description: Execute anonymous apex via the tooling api if namespace is used.
        class_path: tasks.namespaces.ExecuteAnonymousTask
        group: Salesforce

    robot:
        options:
            suites: robot/pmdm/tests
            options:
                outputdir: robot/pmdm/results

    robot_testdoc:
        options:
            path: robot/pmdm/tests
            output: robot/pmdm/doc/pmdm_tests.html

    update_admin_profile:
        options:
            package_xml: lib/admin_profile.xml

    update_admin_profile_caseman:
        class_path: cumulusci.tasks.salesforce.UpdateAdminProfile
        options:
            package_xml: lib/caseman.profile.xml
            record_types:
                - record_type: Account.caseman__Branch
                  default: True
                - record_type: Case.caseman__ClientCase
                  default: True
                - record_type: Case.caseman__Incident
                - record_type: Case.None

    update_admin_profile_npsp:
        class_path: cumulusci.tasks.salesforce.UpdateAdminProfile
        options:
            package_xml: lib/npsp_admin_profile.xml
            record_types:
                - record_type: Account.HH_Account
                - record_type: Account.Organization
                  default: true
                  person_account_default: true
                - record_type: Opportunity.Donation
                  default: true
                - record_type: Campaign.Default
                  default: true

    update_admin_profile_caseman_npsp:
        class_path: cumulusci.tasks.salesforce.UpdateAdminProfile
        options:
            package_xml: lib/caseman.npsp.profile.xml
            record_types:
                - record_type: Account.HH_Account
                - record_type: Account.Organization
                  default: true
                - record_type: Account.caseman__Branch
                  person_account_default: true
                - record_type: Opportunity.Donation
                  default: true
                - record_type: Campaign.Default
                  default: true
                - record_type: Case.caseman__ClientCase
                  default: True
                - record_type: Case.caseman__Incident
                - record_type: Case.None

    run_all_local_tests:
        group: "Tests"
        description: "Runs all local Apex Tests including code coverage"
        class_path: cumulusci.tasks.sfdx.SFDXOrgTask
        options:
            command: "force:apex:test:run --codecoverage --testlevel RunLocalTests --resultformat human"

    run_tests:
        options:
            retry_failures:
                - "unable to obtain exclusive access to this record"
                - "UNABLE_TO_LOCK_ROW"
            retry_always: True
    dx:
        group: "Salesforce DX"
        description: "Calls a sfdx task with the cci Org User specificed.  Enter the sfdx task with the command option"
        class_path: cumulusci.tasks.sfdx.SFDXOrgTask

    dx_status:
        group: "Salesforce DX"
        description: "Calls sfdx force:source:status for cci Org User"
        class_path: cumulusci.tasks.sfdx.SFDXOrgTask
        options:
            command: "force:source:status"

    activate_flows:
        description: This task activates all the process builder processes in the org
        class_path: tasks.ActivateProcessBuilders.ActivateProcessBuilderProcesses

    add_caseman_dependency:
        group: Impact Engineering
        description: Installs CaseMan with dependencies
        class_path: cumulusci.tasks.salesforce.UpdateDependencies
        options:
            dependencies:
                - github: "https://github.com/SalesforceFoundation/caseman"
            include_beta: True

    log_bulk_data_mapping:
        group: "Data: Bulk"
        description: "Generates a combined mapping configuration for cumulusci.tasks.bulkdata"
        class_path: tasks.BulkData2.LogMapping
        options:
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml
            log_mapping: table

    create_bulk_data_mapping:
        group: "Data: Bulk"
        description: "Generates a combined mapping configuration for cumulusci.tasks.bulkdata"
        class_path: tasks.BulkData2.CreateMapping
        options:
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml
            post_mapping_configs:
                - path: data/bulk/mapping/unpackaged/caseman.yml
                  when_all_namespaces:
                      - caseman
            log_mapping: table

    capture_bulk_data:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml
            post_mapping_configs:
                - path: data/bulk/mapping/unpackaged/caseman.yml
                  when_all_namespaces:
                      - caseman
            log_mapping: table

    capture_bulk_data_contacts:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/c/Contacts.sql
            pre_mapping_configs:
                - path: decentralized-data/c/Contacts.yml

    capture_bulk_data_household_accounts:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/c/Household_Accounts.sql
            pre_mapping_configs:
                - path: decentralized-data/c/Household_Accounts.yml

    capture_bulk_data_organization_accounts:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/c/Organization_Accounts.sql
            pre_mapping_configs:
                - path: decentralized-data/c/Organization_Accounts.yml

    capture_bulk_data_caseman:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/caseman/caseman.sql
            package_mapping_directories:
                - decentralized-data/caseman

    capture_bulk_data_caseman_unpackaged:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/caseman/unpackaged.sql
            pre_mapping_configs:
                - path: decentralized-data/caseman/unpackaged.yml
                  inject_project_namespace: true
    
    capture_bulk_data_npe01:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/npe01/npe01.sql
            package_mapping_directories:
                - decentralized-data/npe01
    
    capture_bulk_data_npe4:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/npe4/npe4.sql
            package_mapping_directories:
                - decentralized-data/npe4
    
    capture_bulk_data_npo02:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/npo02/npo02.sql
            package_mapping_directories:
                - decentralized-data/npo02
    
    capture_bulk_data_npsp:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/npsp/npsp.sql
            package_mapping_directories:
                - decentralized-data/npsp
    
    capture_bulk_data_pmdm0:
        group: "Data: Bulk"
        description: "Captures a snapshot of org's bulk data to sql_path.  Only uses in an org with all possible packages installed."
        class_path: tasks.BulkData2.CaptureData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            log_mapping: table
            sql_path: decentralized-data/pmdm0/pmdm0.sql
            package_mapping_directories:
                - decentralized-data/pmdm0
    
    capture_bulk_data_orig:
        group: "Data: Bulk"
        description: "include sql_path and mapping"
        class_path: tasks.bulkdata.ExtractData

    insert_bulk_data:
        group: "Data: Bulk"
        description: "Inserts bulk data at sql_path into org with auto-generated mapping"
        class_path: tasks.BulkData2.InsertData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml
            post_mapping_configs:
                - path: data/bulk/mapping/unpackaged/caseman.yml
                  when_all_namespaces:
                      - caseman

    insert_combined_bulk_data:
        group: "Data: Bulk"
        description: "Inserts bulk data at sql_path into org with auto-generated mapping"
        class_path: tasks.BulkData2.InsertData
        options:
            sql_path: data/bulk/data.sql
            ignore_row_errors: True
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml
            post_mapping_configs:
                - path: data/bulk/mapping/unpackaged/caseman.yml
                  when_all_namespaces:
                      - caseman
            combine_sql: True
            data:
                - map: decentralized-data/c/Contacts.yml
                  sql: decentralized-data/c/Contacts.sql
                  namespace: c
                - map: decentralized-data/c/Household_Accounts.yml
                  sql: decentralized-data/c/Household_Accounts.sql
                  namespace: c
                - map: decentralized-data/c/Organization_Accounts.yml
                  sql: decentralized-data/c/Organization_Accounts.sql
                  namespace: c
                - map: decentralized-data/pmdm0/pmdm0.yml
                  sql: decentralized-data/pmdm0/pmdm0.sql
                  namespace: pmdm0
                - map: decentralized-data/caseman/caseman.yml
                  sql: decentralized-data/caseman/caseman.sql
                  namespace: pmdm0
                - map: decentralized-data/caseman/unpackaged.yml
                  sql: decentralized-data/caseman/unpackaged.sql
                  namespace: c
                  when_all_namespaces:
                    - caseman
    
    log_mapping:
        group: "Data: Bulk"
        class_path: tasks.BulkData2.LogBulkDataMapTask
        options:
            log_mapping: table
            bulk_data:
                Contacts:
                    map: decentralized-data/c/Contacts.yml
                    sql: decentralized-data/c/Contacts.sql
                    namespace: c
                Household_Accounts:
                    map: decentralized-data/c/Household_Accounts.yml
                    sql: decentralized-data/c/Household_Accounts.sql
                    namespace: c
                Organization_Accounts:
                    map: decentralized-data/c/Organization_Accounts.yml
                    sql: decentralized-data/c/Organization_Accounts.sql
                    namespace: c
                pmdm0:
                    map: decentralized-data/pmdm0/pmdm0.yml
                    sql: decentralized-data/pmdm0/pmdm0.sql
                    namespace: pmdm0
                caseman:
                    map: decentralized-data/caseman/caseman.yml
                    sql: decentralized-data/caseman/caseman.sql
                    namespace: caseman
                caseman_unpackaged:
                    map: decentralized-data/caseman/unpackaged.yml
                    sql: decentralized-data/caseman/unpackaged.sql
                    namespace: c
                    when_all_namespaces:
                        - caseman
                npe01:
                    map: decentralized-data/npe01/npe01.yml
                    sql: decentralized-data/npe01/npe01.sql
                    namespace: npe01
                npe4:
                    map: decentralized-data/npe4/npe4.yml
                    sql: decentralized-data/npe4/npe4.sql
                    namespace: npe4
                npo02:
                    map: decentralized-data/npo02/npo02.yml
                    sql: decentralized-data/npo02/npo02.sql
                    namespace: npo02
                npsp:
                    map: decentralized-data/npsp/npsp.yml
                    sql: decentralized-data/npsp/npsp.sql
                    namespace: npsp

    capture_specified_bulk_data:
        group: "Data: Bulk"
        class_path: tasks.BulkData2.CaptureBulkDataDataTask
        options:
            bulk_data:
                Contacts:
                    map: decentralized-data/c/Contacts.yml
                    sql: decentralized-data/c/Contacts.sql
                    namespace: c
                Household_Accounts:
                    map: decentralized-data/c/Household_Accounts.yml
                    sql: decentralized-data/c/Household_Accounts.sql
                    namespace: c
                Organization_Accounts:
                    map: decentralized-data/c/Organization_Accounts.yml
                    sql: decentralized-data/c/Organization_Accounts.sql
                    namespace: c
                pmdm0:
                    map: decentralized-data/pmdm0/pmdm0.yml
                    sql: decentralized-data/pmdm0/pmdm0.sql
                    namespace: pmdm0
                caseman:
                    map: decentralized-data/caseman/caseman.yml
                    sql: decentralized-data/caseman/caseman.sql
                    namespace: caseman
                caseman_unpackaged:
                    map: decentralized-data/caseman/unpackaged.yml
                    sql: decentralized-data/caseman/unpackaged.sql
                    namespace: c
                    when_all_namespaces:
                        - caseman
                npe01:
                    map: decentralized-data/npe01/npe01.yml
                    sql: decentralized-data/npe01/npe01.sql
                    namespace: npe01
                npe4:
                    map: decentralized-data/npe4/npe4.yml
                    sql: decentralized-data/npe4/npe4.sql
                    namespace: npe4
                npo02:
                    map: decentralized-data/npo02/npo02.yml
                    sql: decentralized-data/npo02/npo02.sql
                    namespace: npo02
                npsp:
                    map: decentralized-data/npsp/npsp.yml
                    sql: decentralized-data/npsp/npsp.sql
                    namespace: npsp


    update_client_photo_directories:
        group: "CaseMan: Test Data"
        description: "Update client photo directories after capture_test_data"
        class_path: "tasks.UpdateClientPhotoDirectories.UpdateClientPhotoDirectories"
        options:
            directory_path: "data/bulk/client-photos"
            sql_path: "data/bulk/data.sql"

    upload_client_photos:
        group: "Data: Bulk: CaseMan"
        description: "Upload client photos and link to client records"
        class_path: "tasks.UploadClientPhotos.UploadClientPhotos"
        options:
            directory_path: "data/bulk/client-photos"

    deploy_dev_config:
        group: "pmdm: Config"
        description: Deploys the post-install configuration for an unmanaged DE org
        class_path: cumulusci.tasks.salesforce.Deploy
        options:
            path: unpackaged/config/dev
            namespace_inject: $project_config.project__package__namespace

    uninstall_packaged_incremental:
        description: Deletes any metadata from the package in the target org not in the local workspace
        class_path: cumulusci.tasks.salesforce.UninstallPackagedIncremental
        options:
            ignore:
                QuickAction:
                    - NewEvent
                    - NewCase
                    - NewLead
                    - NewContact
                    - NewOpportunity
                    - NewTask
                    - LogACall

    deploy_service_delivery_modal_test:
        group: "pmdm: tests"
        description: Deploys a testModal component to test serviceDeliveryModal component
        class_path: cumulusci.tasks.salesforce.Deploy
        options:
            path: unpackaged/tests/serviceDeliveryModal
            namespace_inject: $project_config.project__package__namespace

    delete_bulk_data:
        group: "pmdm: data"
        description: "I need a description"
        class_path: tasks.BulkData2.DeleteData
        options:
            hardDelete: True
            package_mapping_directories:
                - data/bulk/mapping/caseman
                - data/bulk/mapping/npsp
                - data/bulk/mapping/pmdm
            pre_mapping_configs:
                - path: data/bulk/mapping/Household_Accounts.yml
                - path: data/bulk/mapping/Organization_Accounts.yml
                - path: data/bulk/mapping/Contacts.yml


flows:
    capture:
        steps:
            110:
                task: capture_bulk_data_contacts
            120:
                task: capture_bulk_data_household_accounts
            130:
                task: capture_bulk_data_organization_accounts
            140:
                task: capture_bulk_data_caseman
            150:
                task: capture_bulk_data_caseman_unpackaged
            160:
                task: capture_bulk_data_npe01
            170:
                task: capture_bulk_data_npe4
            180:
                task: capture_bulk_data_npo02
            190:
                task: capture_bulk_data_npsp
            195:
                task: capture_bulk_data_pmdm0

    delete_insert_capture:
        steps:
            100:
                task: delete_bulk_data
            200:
                flow: insert_data
            300:
                flow: capture

    capture_bulk_data:
        steps:
            100:
                task: capture_bulk_data
            200:
                task: update_client_photo_directories

    insert_data:
        steps:
            010:
                task: cache_namespaces_in_org_config
            100:
                flow: insert_bulk_data
            210:
                task: execute_anon
                options:
                    path: "data/scripts/delete_sample_contacts_and_accounts.apex"

            999:
                task: execute_anon
                options:
                    path: "data/scripts/update_all_records_as_recently_viewed.apex"

    insert_managed_data:
        steps:
            010:
                task: cache_namespaces_in_org_config
            100:
                flow: insert_managed_bulk_data
            210:
                task: execute_anon
                options:
                    path: "data/scripts/delete_sample_contacts_and_accounts.apex"
            999:
                task: execute_anon
                options:
                    path: "data/scripts/update_all_records_as_recently_viewed.apex"

    assign_managed_pmdm_permsets:
        steps:
            110:
                task: dx
                options:
                    command: "force:user:permset:assign --permsetname pmdm0__PMDM_View"
            120:
                task: dx
                options:
                    command: "force:user:permset:assign --permsetname pmdm0__PMDM_Manage"
            130:
                task: dx
                options:
                    command: "force:user:permset:assign --permsetname pmdm0__PMDM_Deliver"

    caseman_post_insert_bulk_data:
        steps:
            100:
                task: upload_client_photos
                when: "'caseman' in org_config.namespace_info.namespaces"

    npsp_post_insert_bulk_data:
        steps:
            100:
                task: execute_anon
                options:
                    path: "data/scripts/npsp/de-duplicate_npsp_relationships.apex"
                when: "'npsp' in org_config.namespace_info.namespaces"

    npsp_pre_insert_bulk_data:
        steps:
            010:
                task: execute_anon
                options:
                    path: "data/scripts/npsp/set_npsp_gender_relationship_setting.apex"
                when: "'npsp' in org_config.namespace_info.namespaces"

    caseman_pre_insert_bulk_data:
        steps:
            10:
                task: dx
                options:
                    command: "force:user:permset:assign --permsetname ManageCases"
                when: "'caseman' in org_config.namespace_info.namespaces"
            20:
                task: dx
                options:
                    command: "force:user:permset:assign --permsetname ManagePrograms"
                when: "'caseman' in org_config.namespace_info.namespaces"

    insert_bulk_data:
        steps:
            010:
                flow: npsp_pre_insert_bulk_data
            020:
                flow: caseman_pre_insert_bulk_data
            100:
                task: insert_bulk_data
            210:
                flow: npsp_post_insert_bulk_data
            220:
                flow: caseman_post_insert_bulk_data

    insert_managed_bulk_data:
        steps:
            010:
                flow: npsp_pre_insert_bulk_data
            020:
                flow: caseman_pre_insert_bulk_data
            030:
                flow: assign_managed_pmdm_permsets
            100:
                task: insert_bulk_data
                options:
                    skip_mapping_project: True
            210:
                flow: npsp_post_insert_bulk_data
            220:
                flow: caseman_post_insert_bulk_data

    update_admin_profile:
        steps:
            01:
                task: cache_namespaces_in_org_config
            10:
                task: update_admin_profile
                when: "'caseman' not in org_config.namespace_info.namespaces and 'npsp' not in org_config.namespace_info.namespaces"
            20:
                task: update_admin_profile_caseman
                when: "'caseman' in org_config.namespace_info.namespaces and 'npsp' not in org_config.namespace_info.namespaces"
            30:
                task: update_admin_profile_npsp
                when: "'caseman' not in org_config.namespace_info.namespaces and 'npsp' in org_config.namespace_info.namespaces"
            40:
                task: update_admin_profile_caseman_npsp
                when: "'caseman' in org_config.namespace_info.namespaces and 'npsp' in org_config.namespace_info.namespaces"

    caseman_org:
        steps:
            100:
                task: add_caseman_dependency
            200:
                flow: dev_org

    caseman_org_namespaced:
        steps:
            100:
                task: add_caseman_dependency
            200:
                flow: dev_org_namespaced

    install_beta_with_caseman:
        steps:
            100:
                task: add_caseman_dependency
            200:
                flow: install_beta

    config_unmanaged:
        steps:
            101:
                flow: update_admin_profile
            105:
                task: deploy_dev_config
                options:
                    unmanaged: True
            110:
                task: activate_flows
            200:
                flow: insert_data

    config_unmanaged_namespaced:
        steps:
            100:
                flow: update_admin_profile
            111:
                task: deploy_dev_config
                options:
                    unmanaged: False
            102:
                task: activate_flows
            200:
                flow: insert_data

    config_managed:
        steps:
            100:
                flow: update_admin_profile
            102:
                task: activate_flows
            200:
                flow: insert_managed_data

    config_qa:
        steps:
            100:
                task: activate_flows
            200:
                flow: config_unmanaged

    config_dev:
        steps:
            200:
                flow: config_unmanaged

    config_dev_namespaced:
        steps:
            100:
                task: deploy_post
            200:
                flow: config_unmanaged_namespaced

    dev_org_namespaced:
        steps:
            1:
                flow: dependencies
            2:
                flow: deploy_unmanaged
            3:
                flow: config_dev_namespaced
            4:
                task: snapshot_changes
